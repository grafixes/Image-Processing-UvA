%% Image Rotation
% Performs a rotation transformation with a 
% specified angle on a provided image around
% its center.
function rotatedImage = rotateImage(image, angle, ...
                        interpolationMethod, addMargins)
    
    % Set the addMargins flag to false by default
    if ~exist('addMargins', 'var'), addMargins = false; end
    if addMargins
        [m, n, topMargin, horzMargin] = imageRotationMargins(image, angle)
    else
        [m, n] = size(image)
    end
      
    center = round([m, n]/2);
    numberOfIndices = m*n;
    
    R = rot(angle);
    [X, Y] = meshgrid(1:n, 1:m);
    indices = [X(:)'; Y(:)'; ones(1, numberOfIndices)];
    
    rotatedIndices = trans([topMargin, leftMargin]) * trans(center) * (R * (trans(-center) * indices));
    rotatedImage = zeros(m, n);
    
    for i = 1:numberOfIndices
        rotatedImage(indices(2, i), indices(1, i)) = pixelValue(image, ...
            rotatedIndices(1, i), rotatedIndices(2, i), interpolationMethod);
    end
end